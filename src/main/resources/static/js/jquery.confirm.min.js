(function (a) {
    a.fn.confirm = function (b) {
        if (typeof b === "undefined") {
            b = {};
        }
        this.click(function (c) {
            c.preventDefault();
            var d = a.extend({button: a(this)}, b);
            a.confirm(d, c);
        });
        return this
    };
    a.confirm = function (f, i) {
        if (a(".confirmation-modal").length > 0) {
            return
        }
        var j = {};
        if (f.button) {
            var b = {
                title: "title",
                text: "text",
                "confirm-button": "confirmButton",
                "submit-form": "submitForm",
                "cancel-button": "cancelButton",
                "confirm-button-class": "confirmButtonClass",
                "cancel-button-class": "cancelButtonClass",
                "dialog-class": "dialogClass"
            };
            a.each(b, function (e, k) {
                var l = f.button.data(e);
                if (l) {
                    j[k] = l;
                }
            })
        }
        var g = a.extend({}, a.confirm.options, {
            confirm: function () {
                debugger;
                if (j.submitForm) {
                    i.target.closest("form").submit()
                } else {
                    var e = i && (("string" === typeof i && i) || (i.currentTarget && i.currentTarget.attributes.href.value));
                    if (e) {
                        // 执行更新操作
                        _do(f.button[0], e);
                    }
                }
            }, cancel: function (e) {
            }, button: null
        }, j, f);
        var c = "";
        if (g.title !== "") {
            c = '<div class="modal-header">' +
                '<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>' +
                '<h4 class="modal-title">' + g.title + '</h4>' +
                '</div>';
        }
        var d = '<div class="confirmation-modal modal fade" tabindex="-1" role="dialog">' +
            '<div class="' + g.dialogClass + '">' +
            '<div class="modal-content">' + c +
            '<div class="modal-body">' + g.text + '</div>' +
            '<div class="modal-footer">' +
            '<button class="confirm btn ' + g.confirmButtonClass + '" type="button" data-dismiss="modal">' + g.confirmButton + '</button>' +
            '<button class="cancel btn ' + g.cancelButtonClass + '" type="button" data-dismiss="modal">' + g.cancelButton + '</button>' +
            '</div>' +
            '</div>' +
            '</div>' +
            '</div>';

        var h = a(d);
        h.on("shown.bs.modal", function () {
            h.find(".btn-primary:first").focus();
        });
        h.on("hidden.bs.modal", function () {
            h.remove();
        });
        h.find(".confirm").click(function () {
            g.confirm(g.button);
        });
        h.find(".cancel").click(function () {
            g.cancel(g.button);
        });
        a("body").append(h);
        h.modal("show");
    };
    a.confirm.options = {
        text: "确定删除?",
        title: "",
        confirmButton: "确定",
        cancelButton: "取消 ",
        get: true,
        submitForm: false,
        confirmButtonClass: "btn-primary",
        cancelButtonClass: "btn-default",
        dialogClass: "modal-dialog"
    }

})(jQuery);

function f() {

}

function _ajax(url, method = 'get', data, async = true, callback) {
    $.ajax({
        url: url,
        method: method,
        data: data,
        async: async,
        success: function (data) {
            // debugger;
            if (data.success) {
                if (callback) {
                    callback(data);
                }
            } else {

            }
        }
    })
    ;
}

function deleteMsg(msg = '操作成功！') {
    $('#msg').append(`<div class="alert alert-success fade in" style="position: absolute; width: 100%;z-index: 10;">
                         <strong>${msg}</strong> 
                         <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                             <!--<span aria-hidden="true">&times;</span>-->
                         </button>
                       </div>`);
}

function closeAlertMsg(callback) {
    window.setTimeout(function () {
        $('[data-dismiss="alert"]').alert('close');
        if (callback) {
            callback();
        }
    }, 3000);
}

function _do(btn, e) {
    if (/delete/.test(btn.dataset.method)) {
        _ajax(e, 'delete', null, false);
        deleteMsg();
        closeAlertMsg(refresh);
        // $(btn).parentsUntil('tbody', 'tr').parent().remove();
    } else if (/update/.test(btn.dataset.method)) {

    }

}

function refresh() {
    window.location.reload();
}