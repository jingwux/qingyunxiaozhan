$(function () {
    function a(a) {
        $.getJSON("/admin/project/" + a,
            function (a) {
                a = a.data;
                bootbox.dialog({
                    title: "更新项目",
                    message: '<div class="row">' +
                        '<div class="col-md-12">' +
                        '<form class="form-horizontal" id="add_pro_form" name="updateForm">' +
                        ' <input name="id" type="hidden" value="' + a.id + '">' + '<div class="form-group"> ' + '<label class="col-md-2 control-label">项目名</label> ' + '<div class="col-md-9"> ' + '<input name="name" type="text" placeholder="project name" value="' + a.name + '" class="form-control input-md"> ' + "</div></div>" + '<div class="form-group"> ' + '<label class="col-md-2 control-label">地址</label> ' + '<div class="col-md-9"> ' + '<input name="url" type="text" placeholder="project url" value="' + a.url + '" class="form-control input-md"> ' + "</div></div>" + '<div class="form-group"> ' + '<label class="col-md-2 control-label">技术方向</label> ' + '<div class="col-md-9"> ' + '<textarea class="form-control" rows="3" name="tech" maxlength="220">' + a.tech + "</textarea></div></div>" + '<div class="form-group"> ' + '<label class="col-md-2 control-label">描述</label> ' + '<div class="col-md-9"> ' + '<textarea class="form-control" rows="5" name="description">' + a.description + "</textarea></div></div>" + "</form> </div>  </div>",
                    buttons: {
                        success: {
                            label: "更新",
                            className: "btn-success",
                            callback: function () {
                                var a = document.getElementById("add_pro_form");
                                let data = $(a).serialize();
                                _ajax("/admin/project", "put", data, true, refresh);

                            }
                        }
                    }
                })
            })
    }

    $("#info_update").bind("click", function () {
        var a = document.forms[0];
        a.action = "/admin/info.do",
            a.method = "post",
            a.submit()
    });
    $("#update_pass").bind("click", function () {
        var d, a = document.newPassForm.old_pass_bef.value,
            b = document.newPassForm.new_pass_one.value,
            c = document.newPassForm.new_pass_two.value;
        b != c ? alert("Two passwords are not consistent!") : (d = document.forms[1], d.action = "/admin/pass.do", d.method = "post", document.newPassForm.old_pass.value = md5(a), document.newPassForm.new_pass.value = md5(b), d.submit())
    });
    $("#login-admin").bind("click", function () {
        var b, a = document.forms[0];
        a.action = "/login",
            b = document.loginForm.passBefore.value,
            document.loginForm.password.value = b,
            a.method = "post",
            a.submit()
    });
    $(document).on("click", "#add_project", function () {
        bootbox.dialog({
            title: "添加项目",
            message: '<div class="row">  ' +
                '<div class="col-md-12"> ' +
                '<form class="form-horizontal" id="add_pro_form"> ' +
                '<div class="form-group"> ' +
                '<label class="col-md-2 control-label">项目名</label>' +
                '<div class="col-md-9"><input name="name" type="text" placeholder="project name" class="form-control input-md"> </div>' +
                '</div>' +
                '<div class="form-group">' +
                '<label class="col-md-2 control-label">地址</label> ' +
                '<div class="col-md-9"><input name="url" type="text" placeholder="project url" class="form-control input-md"> </div>' +
                '</div>' +
                '<div class="form-group"> ' +
                '<label class="col-md-2 control-label">技术方向</label> ' +
                '<div class="col-md-9"> <textarea class="form-control" rows="3" name="tech" maxlength="220"></textarea> </div>' +
                '</div>' +
                '<div class="form-group">' +
                '<label class="col-md-2 control-label">描述</label>' +
                '<div class="col-md-9"> <textarea class="form-control" rows="5" name="description"></textarea> </div>' +
                '</div>' +
                '</form> ' +
                '</div>' +
                '</div>',
            buttons: {
                success: {
                    label: "保存",
                    className: "btn-success",
                    callback: function () {
                        var a = document.getElementById("add_pro_form");
                        let data = $(a).serialize();
                        _ajax("/admin/project", "post", data, true, refresh);
                    }
                }
            }
        })
    });


    $(document).on("click", "#add_resource", function () {
        bootbox.dialog({
            title: "添加资源",
            message: '<div class="row">  ' +
                    '<div class="col-md-12"> ' +
                    '<form class="form-horizontal" id="add_pro_form"> ' +
                    '<div class="form-group"> ' +
                    '<label class="col-md-2 control-label">资源名</label>' +
                    '<div class="col-md-9"><input name="resourceName" type="text" placeholder="Resource Name" class="form-control input-md"> </div>' +
                    '</div>' +
                    '<div class="form-group">' +
                    '<label class="col-md-2 control-label">地址</label> ' +
                    '<div class="col-md-9"><input name="url" type="text" placeholder="Resource URL" class="form-control input-md"> </div>' +
                    '</div>' +
                    '<div class="form-group">' +
                    '<label class="col-md-2 control-label">类型</label> ' +
                    '<div class="col-md-9">' +
                        '<select class="form-control">\n' +
                            '<option>请选择资源类型</option>\n' +
                            '<option value="0">电子书籍</option>\n' +
                            '<option value="1">教学视频</option>\n' +
                            '<option value="2">文档资料</option>\n' +
                            '<option value="3">软件</option>\n' +
                            '<option value="4">破解工具</option>\n' +
                        '</select>' +
                    '</div>' +
                    '</div>' +
                    '<div class="form-group">' +
                    '<label class="col-md-2 control-label">状态</label> ' +
                    '<div class="col-md-9"><label class="radio-inline">\n' +
                        '<input type="radio" name="status" id="inlineRadio1" value="0"> 可用\n' +
                        '</label>\n' +
                        '<label class="radio-inline">\n' +
                        '<input type="radio" name="status" id="inlineRadio2" value="1" checked> 不可用\n' +
                        '</label></div>' +
                    '</div>' +
                    '<div class="form-group form-inline"> ' +
                    '<label class="col-md-2 control-label">文件</label> ' +
                    '<div class="col-md-9"><input name="file" type="file" style="display: none;" id="file">  <div class="input-append">\n' +
                        '<!-- 用于展示上传文件名的表单 -->\n' +
                        '<input id="showname" class="form-control" type="text" >\n' +
                        '<!-- 点击触发按钮 -->\n' +
                        '<a class="btn btn-info btn-sm" onclick="makeThisfile()" id="browse" >浏览</a>  \n' +
                    '</div>' +
                    '</div>' +
                    '</div>' +
                    '<div class="form-group">' +
                    '<label class="col-md-2 control-label">描述</label>' +
                    '<div class="col-md-9"> <textarea class="form-control" rows="5" name="desp" maxlength="220"></textarea> </div>' +
                    '</div>' +
                    '</form> ' +
                    '</div>' +
                    '</div>',
            buttons: {
                success: {
                    label: "保存",
                    className: "btn-success",
                    callback: function () {
                        var a = document.getElementById("add_pro_form");
                        /*a.action = "/admin/resource",
                            a.method = "post",
                            a.submit()*/
                    }
                }
            }
        })
    });


    $(".upd_project").click(function () {
        var b = $(this).attr("name");
        a(b)
    });
});